context:
  name: csp-gateway
  version: "2.2.1"

recipe:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://pypi.org/packages/source/c/csp-gateway/csp_gateway-${{ version }}.tar.gz
  sha256: 0606918f233775879ce2ff419bd2796411908a1138ebd0b8d8702b79148092ab

build:
  number: 0

outputs:
  - package:
      name: ${{ name|lower }}
    build:
      noarch: python
      script: python -m pip install . -vv --no-deps --no-build-isolation
      python:
        entry_points:
          - cspgateway-start = csp_gateway.server.cli:main
          - cspgateway_start = csp_gateway.server.cli:main
          - csp-gateway-start = csp_gateway.server.cli:main
          - csp_gateway_start = csp_gateway.server.cli:main
    requirements:
      host:
        - python ${{ python_min }}.*
        - pip
        - hatchling
        - hatch-js
        - hatch-multi
        - pnpm
      run:
        - python >=${{ python_min }}
        - atomic-counter >=0.1.3
        - ccflow >=0.5.9,<1
        - colorlog
        - csp >=0.8.0,<1
        - deprecation
        - duckdb >=0.10
        - fastapi >=0.110
        - fsspec
        - hydra-core
        - janus
        - omegaconf
        - orjson
        - perspective >=3.7,<4
        - psutil
        - pyarrow
        - pydantic >=2
        - uvicorn >=0.28.1,<0.31
        - uvloop
        - websockets
        # Client
        - httpx
        - jsonref
        - nest-asyncio
        - packaging
    tests:
      - python:
          imports:
            - csp_gateway
            - csp_gateway.server
            - csp_gateway.client
          pip_check: true
          python_version: ${{ python_min }}.*
      - script:
          - csp-gateway-start --help
  - package:
      name: ${{ name|lower }}-client
    build:
      noarch: python
      script: python -m pip install . -vv --no-deps --no-build-isolation
    requirements:
      host:
        - python ${{ python_min }}.*
        - pip
        - hatchling
        - hatch-js
        - hatch-multi
        - pnpm
      run:
        - python >=${{ python_min }}
        - httpx
        - jsonref
        - nest-asyncio
        - packaging
        - pydantic >=2
    tests:
      - python:
          imports:
            - csp_gateway
            - csp_gateway.client
          pip_check: false
          python_version: ${{ python_min }}.*

about:
  license: Apache-2.0
  license_file: LICENSE
  summary: Application framework built on CSP
  homepage: https://github.com/point72/csp-gateway
  repository: https://github.com/point72/csp-gateway

extra:
  recipe-maintainers:
    - arhamchopra
    - hintse
    - neejweej
    - ptomecek
    - timkpaine
